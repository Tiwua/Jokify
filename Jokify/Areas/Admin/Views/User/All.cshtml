@using Jokify.Core.Models.Admin;
@model UserPageModel

<style>
    body {
        height: 100%;
        margin: 0;
        font-family: sans-serif;
        font-weight: 100;
    }

    .container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    table {
        width: 1000px;
        height: 50px;
        border-collapse: collapse;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(25, 0, 255, 0.1);
        border: 0.5px solid rgba(25, 0, 255, 0.01);
    }

    th,
    td {
        padding: 15px;
        background-color: rgba(255, 255, 255, 0.2);
        color: #fff;
        text-align: center;
    }

    th {
        text-align: center;
    }
    thead th {
        background-color: #55608f;
    }

    tbody tr:hover {
        background-color: rgba(255, 255, 255, 0.3);
    }

    td:hover {
        position: relative;
    }

        td:hover:before {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            top: -9999px;
            bottom: -9999px;
            background-color: rgba(255, 255, 255, 0.2);
            z-index: -1;
        }

    .delete-user-button {
        background-color: #007bff;
        color: #fff;
        width: 70px;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 3px;
        margin-right: 5px;
        margin-left: 35px;
        position: relative;
        right: 55px;
        top: 20px;
        font-size: 18px;
    }

        .delete-user-button:hover {
            background-color: #ff4b2b;
            transform: scale(1.1);
        }

    .forget-user-button {
        background-color: #007bff;
        color: #fff;
        width: 70px;
        border: none;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 3px;
        margin-right: 5px;
        margin-left: 35px;
        position: relative;
        left: 35px;
        font-size: 18px;
        bottom: 15px;
    }

        .forget-user-button:hover {
            background-color: #ff4b2b;
            transform: scale(1.1);
        }

    .text-center {
        text-align: center;
    }
    .arrow-box-disabled {
        display: none;
    }

    .arrow-box {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 55px;
        height: 45px;
        background-color: #ff4b2b;
        padding: 10px;
        transition: transform 0.3s ease;
        border-radius: 10px;
        position: relative;
        top: 200px;
        right: 600px;
    }

    .arrow {
        color: white;
        position: absolute;
        width: 35px;
        height: 30px;
        transition: transform 0.3s ease;
        font-weight: 900;
        font-size: 35px;
        line-height: 0.5;
    }

        .arrow::before,
        .arrow::after {
            position: absolute;
            width: 10px;
            height: 2px;
        }

    .button-left::before,
    .button-left::after,
    .button-right::before,
    .button-right::after {
        background-color: #fff;
    }

    .button-left::before {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-45deg);
    }

    .button-left::after {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(45deg);
    }

    .button-right::before {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(135deg);
    }

    .button-right::after {
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-135deg);
    }

    .arrow-box:hover {
        transform: scale(1.1);
    }

    .arrow:hover {
        transform: scale(1.1);
    }

    .right {
        position: absolute;
        top: 25px;
        left: 750px;
    }

    .left {
        position: absolute;
        top: 25px;
        left: 380px;
    }
</style>


@{
    var previousPage = Model.CurrentPage - 1;
    if (previousPage < 1)
    {
        previousPage = 1;
    }

    var maxPage = Math.Ceiling((double)Model.TotalUsers /
    Model.PageSize);
}

@{
    var shouldButtonBeDisabled = Model.CurrentPage == maxPage ||
    Model.TotalUsers == 0;
}

<div class="left">
    <a class="arrow-box@(Model.CurrentPage == 1 ? "-disabled" : string.Empty)"
       asp-area="Admin"
       asp-controller="User"
       asp-action="All"
       asp-route-page="@previousPage">
        <span class="arrow button-left">
            &larr;
        </span>
    </a>
</div>


<div class="right">
    <a class="arrow-box@(shouldButtonBeDisabled ? "-disabled" : string.Empty)"
       asp-area="Admin"
       asp-controller="User"
       asp-action="All"
       asp-route-page="@(Model.CurrentPage + 1)">
        <span class="arrow button-right">
            &rarr;
        </span>
    </a>
</div>
<div class="container">
    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>IsDeleted</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var user in Model.Users)
            {
                <tr>
                    <td>@user.Username</td>
                    <td>@user.Email</td>
                    <td>@(user.IsDeleted ? "Yes" : "No")</td>
                    <td>
                        @if (!user.IsDeleted)
                        {
                            <form method="post"
                             asp-area="Admin"
                             asp-controller="User" 
                             asp-action="Delete"
                             asp-route-id="@user.UserId"
                             asp-route-page="@Model.CurrentPage">

                                <button type="submit" class="delete-user-button" onclick="deleteUserConfirm(event)">Delete</button>
                            </form>
                        }
                        @if (!user.IsForgotten)
                        {
                            <form method ="post" 
                             asp-area="Admin"
                             asp-controller="User" 
                             asp-action="Forget"  
                             asp-route-id="@user.UserId"
                             asp-route-page="@Model.CurrentPage">

                                <button type="submit" class="forget-user-button" onclick="forgetConfirm(event)">Forget</button>
                            </form>
                        }           
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    function forgetConfirm(e) {
        e.preventDefault();
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            cancelButtonText: 'Cancel',
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, forget them'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire(
                    'Deleted!',
                    'The user has been forgotten.',
                    'success'
                ).then((resultDeleted) => {
                    e.target.parentElement.submit();
                })
            }
        })
    }

    function deleteUserConfirm(e) {
        e.preventDefault();
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            cancelButtonText: 'Cancel',
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete them'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire(
                    'Deleted!',
                    'The user has been deleted.',
                    'success'
                ).then((resultDeleted) => {
                    e.target.parentElement.submit();
                })
            }
        })
    }
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
<script src="~/lib/limonte-sweetalert2/sweetalert2.js"></script>
<script src="~/lib/limonte-sweetalert2/sweetalert2.all.js"></script>
<script src="~/lib/limonte-sweetalert2/sweetalert2.all.min.js"></script>
<script src="~/lib/limonte-sweetalert2/sweetalert2.js"></script>
<script src="~/lib/limonte-sweetalert2/sweetalert2.min.js"></script>
<link href="~/lib/limonte-sweetalert2/sweetalert2.css" rel="stylesheet" />
<link href="~/lib/limonte-sweetalert2/sweetalert2.min.css" rel="stylesheet" />